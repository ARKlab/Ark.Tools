<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build">
  <Sdk Name="Microsoft.Build.Sql" Version="0.1.19-preview" />
  <PropertyGroup>
    <Name>Ark.Reference.Core.Database</Name>
    <ProjectGuid>{bee200d4-b2fc-4384-bda2-5ccab62c1597}</ProjectGuid>
    <DSP>Microsoft.Data.Tools.Schema.Sql.Sql160DatabaseSchemaProvider</DSP>
    <OutputType>Database</OutputType>
    <ModelCollation>1033, CI</ModelCollation>
    <DefaultFileStructure>BySchemaAndSchemaType</DefaultFileStructure>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <SqlServerVerification>False</SqlServerVerification>
    <IncludeCompositeObjects>True</IncludeCompositeObjects>
    <TargetDatabaseSet>True</TargetDatabaseSet>
    <DefaultCollation>SQL_Latin1_General_CP1_CI_AS</DefaultCollation>
    <CompatibilityMode>150</CompatibilityMode>
    <AutoShrink>True</AutoShrink>
    <DbScopedConfigOptimizerHotfixes>On</DbScopedConfigOptimizerHotfixes>
    <Parameterization>FORCED</Parameterization>
    <AutoUpdateStatisticsAsynchronously>True</AutoUpdateStatisticsAsynchronously>
    <AllowSnapshotIsolation>True</AllowSnapshotIsolation>
    <ReadCommittedSnapshot>False</ReadCommittedSnapshot>
	<IsWindows Condition="'$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Windows)))' == 'true'">true</IsWindows>
    <IsLinux Condition="'$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Linux)))' == 'true'">true</IsLinux>

  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.SqlServer.Dacpacs.Master" Version="160.0.0" />
  </ItemGroup>
  <ItemGroup>
    <!-- Build default globbing pattern includes all sql files in all subfolders, excluding bin and obj -->
    <Build Include="**/*.sql" />
    <Build Remove="bin/**/*.sql" />
    <Build Remove="obj/**/*.sql" />
    <Build Remove="_Migrations/**/*.sql" />
  </ItemGroup>
  <ItemGroup>
    <Build Include="dbo\Tables\Outbox.sql" />
    <Build Include="dbo\Tables\Ping.sql" />
    <Build Include="ops\InitConfig.sql" />
    <Build Include="ops\ResetFull_OnlyForTesting.sql" />
    <Build Include="Security\Schemas.sql" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Ark.Reference.Core.Database.publish.xml" />
  </ItemGroup>
  <ItemGroup>
    <PostDeploy Include="Script.PostDeployment.sql">
      <CopyToOutputDirectory>DoNotCopy</CopyToOutputDirectory>
    </PostDeploy>
  </ItemGroup>
  <ItemGroup>
    <Folder Include="dbo\" />
    <Folder Include="dbo\Tables\" />
    <Folder Include="ops\" />
    <Folder Include="Security\" />
    <Folder Include="_Migrations\" />
  </ItemGroup>
  <ItemGroup>
    <None Include="_Migrations/*.sql" />
  </ItemGroup>
  <PropertyGroup>
    <PostBuildEvent Condition="'$(IsWindows)' == 'true'">copy /y "$(SolutionDir)Ark.ReferenceProject\Core\Ark.Reference.Core.Database\bin\$(Configuration)\*.dacpac" "$(SolutionDir)Ark.ReferenceProject\Core\Ark.Reference.Core.Tests\"</PostBuildEvent>
    <PostBuildEvent Condition="'$(IsLinux)' == 'true'">cp -rf --verbose  "$(SolutionDir)Ark.ReferenceProject/Core\Ark.Reference.Core.Database/bin/$(Configuration)/*.dacpac" "$(SolutionDir)Ark.ReferenceProject/Core\Ark.Reference.Core.Tests/"</PostBuildEvent>
  </PropertyGroup>
</Project>