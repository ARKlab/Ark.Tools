<Project Sdk="Microsoft.NET.Sdk">


  <PropertyGroup Label="Test Settings">
    <IsTestProject>true</IsTestProject>
  </PropertyGroup>

	<ItemGroup>
		<PackageReference Include="ExcelDataReader" />
		<PackageReference Include="ExcelDataReader.DataSet" />
		<PackageReference Include="Microsoft.AspNetCore.TestHost" />
		<PackageReference Include="Microsoft.SqlServer.DacFx" />
		<PackageReference Include="Moq" />
		<PackageReference Include="netDumbster" />
		<PackageReference Include="NodaTime.Testing" />
		<PackageReference Include="Reqnroll.MsTest" />
		<PackageReference Include="Reqnroll.Tools.MsBuild.Generation" />
	</ItemGroup>
	
  <ItemGroup>
    <PackageReference Include="Ark.Tools.Reqnroll" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\Ark.Reference.Common\Ark.Reference.Common.csproj" />
    <ProjectReference Include="..\Ark.Reference.Core.API\Ark.Reference.Core.API.csproj" />
    <ProjectReference Include="..\Ark.Reference.Core.Application\Ark.Reference.Core.Application.csproj" />
    <ProjectReference Include="..\Ark.Reference.Core.Common\Ark.Reference.Core.Common.csproj" />
	  <ProjectReference Include="..\Ark.Reference.Core.Database\Ark.Reference.Core.Database.sqlproj">
		  <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
	  </ProjectReference>
    <ProjectReference Include="..\Ark.Reference.Core.WebInterface\Ark.Reference.Core.WebInterface.csproj" />
  </ItemGroup>


  <ItemGroup>

    <None Update="TestData\**\*.*">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>

  </ItemGroup>
  
  <PropertyGroup>
    <DisableFastUpToDateCheck>true</DisableFastUpToDateCheck>
  </PropertyGroup>

  <!-- Copy dacpac from Database project output before build -->
  <Target Name="CopyDacpacFromDatabaseProject" AfterTargets="ResolveProjectReferences">
    <PropertyGroup>
      <DacpacSourcePath>..\Ark.Reference.Core.Database\bin\$(Configuration)\Ark.Reference.Core.Database.dacpac</DacpacSourcePath>
      <DacpacDestPath>$(MSBuildProjectDirectory)\Ark.Reference.Core.Database.dacpac</DacpacDestPath>
    </PropertyGroup>
    <Copy SourceFiles="$(DacpacSourcePath)" DestinationFiles="$(DacpacDestPath)" Condition="Exists('$(DacpacSourcePath)')" SkipUnchangedFiles="true" />
  </Target>

  <!-- 
    Add the copied dacpac file to the None item group dynamically.
    This must run before AssignTargetPaths, which is the final opportunity to modify 
    None and Content items before they are transformed for copying to output.
    This ensures the dacpac is included in the output even when it's copied during build.
  -->
  <Target Name="IncludeDacpacInOutput" BeforeTargets="AssignTargetPaths" DependsOnTargets="CopyDacpacFromDatabaseProject">
    <ItemGroup>
      <None Include="Ark.Reference.Core.Database.dacpac" Condition="Exists('$(MSBuildProjectDirectory)\Ark.Reference.Core.Database.dacpac')">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      </None>
    </ItemGroup>
  </Target>

</Project>
